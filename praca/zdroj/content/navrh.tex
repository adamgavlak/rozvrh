\chapter{Návrh aplikácie}

\section{Jazyk -- Ruby}

Ruby je dynamický, reflektívny objektovo orientovaný programovací jazyk, ktorý kombinuje syntax inšpirovanú jazykmi Perl, Smalltalk, Eiffel, Lisp a má dynamickú správu pamäti. Autor -- Yukihiro Matsumoto -- pri návrhu vychádzal z filozofie, že programátor by sa pri práci s jazykom mal baviť ale zároveň byť produktívny. Taktiež zdôrazňoval, že dizajn systémov by sa mal zameriavať viac na potreby človeka ako na potreby počítača. \citep{matsumoto2002ruby}

\subsection{Zaujímavé vlastnosti jazyka Ruby}

Ruby je veľmi zaujímavý jazyk, avšak má mnoho vlastností, ktoré by mohli samostatne pokryť ďalšiu prácu. Preto som sa rozhodol vybrať také, ktoré sú netradičné pre iné programovacie jazyky a priblížiť ich.

\clearpage
\subsubsection{Premenné}

Ruby často používa veľmi obmedzenú interpunkciu, ale niektoré znaky sú použité na dekoráciu. Ďalšia vlastnosť je, že Ruby nepotrebuje deklarovať premenné. Zároveň sa používajú jednoduché konvencie na odlíšenie rozsahu premenných:

\begin{itemize}
    \item \emph{var} je lokálna premenná
    \item \emph{@var} je premenná inštancie triedy
    \item \emph{@@var} je premenná triedy
    \item \emph{\texttt{\$var}} je globálna premenná
\end{itemize}

Tieto znaky uľahčujú čitateľnosť výsledného kódu a umožňujú programátorovi jednoducho rozoznať roly každej premennej. \citep{web:rubylang}

\subsubsection{Symboly}

Symbol na prvý pohľad vyzerá ako premenná, ktorá má pred názvom dvojbodku, napríklad \emph{:user}. Výhodou symbolov je, že ich nie je potrebné deklarovať a v celom programe budú mať rovnakú hodnotu. Zoberme nasledujúci príklad:

\begin{minted}{ruby}
puts "string".object_id
puts "string".object_id
puts :symbol.object_id
puts :symbol.object_id
\end{minted}

Po spustení tohto programu sa zobrazil nasledujúci výstup a naozaj dokázal, že symboly majú počas behu programu rovnakú hodnotu:

\begin{minted}{bash}
$ ruby symbol.rb
90520360
90520080
801628
801628
\end{minted}

\subsubsection{Bloky}

Bloky v Ruby sú inšpirované funkcionálnym programovaním, prinášajú do kódu mnoho flexibility a sú v iných jazykoch nazývané aj \emph{closure}. V Ruby sú veľmi užitočnou vlastnosťou pretože nám umožňujú odoslať blok kódu priamo do funkcie. Definujú sa:

\begin{minted}{ruby}
call_block(arg) { |a| puts a }
# alebo
call_block(arg) do |a|
  puts a
end
\end{minted}

Pre využitie bloku vo funkcii musíme použiť funkciu \emph{yield}. Avšak, ak funkcia používa \emph{yield} ale, žiadny block nebol prijatý tak Ruby vyvolá výnimku. Blok môžeme vo funkcii zavolať nasledujúco:

\begin{minted}{ruby}
def call_block(arg)
    yield(arg)
end
\end{minted}

\subsubsection{Moduly}

Ruby nepodporuje viacnásobnú dedičnosť. Keď chceme aby niekoľko tried implementovalo určitú funkcionalitu musíme využiť \emph{module}. V skratke, Module je kolekcia metód a konštánt. Môžeme ho definovať nasledujúco:

\begin{minted}{ruby}
module Mod
  def call_func(arg)
    puts arg
  end
end
\end{minted}

V triede kde požadujeme funkcionalitu modulu potom jednoducho zahrnieme modul pomocou funkcie \emph{include}. Napríklad:

\begin{minted}{ruby}
class MyClass
    include Mod
end
\end{minted}

\subsection{RubyGems}

RubyGems je správca balíčkov používaný spolu s jazykom Ruby, ktorý ponúka štandardný formát pre distribúciu Ruby programov a knižníc vo formáte nazývanom \emph{gem} a uľahčuje ich inštaláciu. Všetky balíčky sa dajú nájisť, prehľadávať alebo pridávať na stránke \url{https://rubygems.org}. V čase písania práce bolo publikovaných 131 tisíc balíčkov a počet stiahnutí presiahol 13,3 miliárd.

\section{Framework -- Ruby on Rails}

Ruby on Rails je framework pre tvorbu webových aplikácii na strane servera pomocou jazyka Ruby. Bol vytvorený v roku 2006 a jeho autorom je David Heinemeier Hansson. Framework je vytvorený na zaujímavej ideológii - konvencia má prednosť pred konfiguráciou. To znamená, že ak vývojár vytvára webovú aplikáciu s pomocou Ruby on Rails tak nastavuje len to čo je dôležité pre chod aplikácie.
Ak vývojár dodržuje tieto konvencie tak spraví menej rozhodnutí, čoho výsledkom je rýchlejší čas vývoja, vylepšená spolupráca na projekte a jednoduchšia údržba aplikácie.

\subsection{Model, view a controller}

Ruby on Rails je založený na návrhovom vzore Model-view-controller (v skratke MVC). Ako názov naznačuje tento vzor sa skladá z troch dôležitých komponentov, ktoré riadia správanie sa aplikácie.

\begin{itemize}
    \item \textbf{Model} reprezentuje iba dáta. Nie je závislý na controller-och alebo view-och
    \item \textbf{View} zobrazuje dáta modelov a odosiela interakciu používateľa cotroller-om
    \item \textbf{Controller} poskytuje dáta z modelu do view-u a spracováva interakciu užívateľa, pričom ontroller je závislý na modeloch a view-och
\end{itemize}

\subsection{Active Record}

Active Record je Object-relational mapping (ORM) knižnica, ktorú Ruby on Rails využíva pre všetky svoje modely. Pri načítaní modelu z databázy sú všetky dáta uložené v pamäti, kde ich môžeme modifikovať a keď sa neskôr rozhodneme ich uložiť, tak Active Record odošle databáze SQL dotaz na zmenu týchto údajov.

\subsection{Migrácie}

Migrácie sú dôležitá súčasť knižnice Active Record, ktoré umožňujú aby sa schéma databázy menila priebežne. Obrovskou výhodou je, že zmeny v schéme sa nemenia pomocou čistého SQL, ale pomocou čistého Ruby DSL na popísanie zmien v tabuľkách.
Každá migrácia je uložená vo svojom súbore. Môže vyzerať napríklad takto:

\begin{minted}{ruby}
class CreateProducts < ActiveRecord::Migration[5.0]
  def change
    create_table :products do |t|
      t.string :name
      t.text :description
 
      t.timestamps
    end
  end
end
\end{minted}

Môžeme uvažovať, že každá migrácia je nová verzia schémy pre databázu. Schému môžeme napísať ručne alebo vygenerovať a potom doplniť operácie ktoré chceme vykonať ako pridanie/vymazanie tabuliek, stĺpcov, indexov alebo iných obmedzení.

\subsection{Generátory}

Ruby on Rails je nainštalovaný aj spolu s jednoduchou aplikáciou, ktorá nám okrem iných nástrojov pri vývoji umožňuje aj generovať súbory, čo nám značne uľahčuje a urýchľuje vývoj aplikácie. Generovanie z príkazového riadku prebieha naslednovne:

\begin{minted}{bash}
$ rails generate GENERATOR [args] [options]
\end{minted}

Slovo \emph{GENERATOR} zameníme za generátor, podľa toho aký súbor/y chceme vygenerovať. Ak do príkazového riadku zadáme iba \emph{rails generate} zobrazí sa nám krátka nápoveda ako generátory používať ale aj zoznam dostupných generátorov. Najdoležitejšie generátory pri vývoji aplikácie sú tieto:

\begin{itemize}
  \item controller
  \item mailer
  \item migration
  \item model
  \item task
\end{itemize}

Ďalej môžeme zadať argumenty, ktoré slúžia na vygenerovanie funkcií, stĺpcov alebo atribútov v závislosti od toho aký generátor máme zvolený.


\section{Prípady použitia}



\section{Databáza a entitno-relačný diagram}

Na perzistentné uloženie dát aplikácie som po porade zvolil databázu SQLite, ktorá má podľa mňa dostatočnú kapacitu a spĺňa všetky požiadavky pre škálu budovanej aplikácie. Má dokonca aj niekoľko výhod:

\begin{itemize}
    \item Jednoduchá inštalácia
    \item Nie je potrebná skoro žiadna konfigurácia
    \item Dáta sú ľahko zálohovateľné, pretože databáza je uložená v jedinom súbore
    \item Šetrí zdroje systému
\end{itemize}

\section{Systém pre správu verzií -- Git}

Pri tvorbe softvéru vývojári vytvárajú zdrojový kód. Menia, rozširujú ho, potrebujú vrátiť zmeny alebo sa vrátiť späť k starším verziám. Taktiež je potrebné zabezpečiť situáciu, keď na jednom projekte pracuje viac vývojárov naraz. \citep{otte2009version} 

Git je jedným z mnohých programov na správu verzií zdrojového kódu vytvorený Linusom Torvaldom v roku 2005. Používať ho budem počas celého vývoja aplikácie aj napriek tomu, že nie som súčasťou žiadneho týmu, pretože mi stále poskytuje niekoľko obrovských výhod, a to: 

\begin{itemize}
    \item Jednoduché a prehľadné zdieľanie zdrojového kódu s vedúcim práce
    \item História všetkých zmien zdrojového kódu
    \item Uľahčenie nasadenia na server
    \item Záloha aplikácie v prípade straty na lokálnom systéme
\end{itemize}